if(!customElements.get("product-form")){class ProductForm extends HTMLElement{constructor(){super(),this.hasChildNodes()&&this.init()}init(){this.form=this.querySelector(".js-product-form"),this.form&&(this.form.querySelector('[name="id"]').disabled=!1,this.cartDrawer=document.querySelector("cart-drawer"),this.submitBtn=this.querySelector('[name="add"]'),theme.settings.afterAtc!=="no-js"&&this.addEventListener("submit",this.handleSubmit.bind(this)))}createFetchBodyForm(){const formData=new FormData(this.form);let sections="cart-icon-bubble";return this.cartDrawer&&(sections+=`,${this.cartDrawer.closest(".shopify-section").id.replace("shopify-section-","")}`),formData.append("sections_url",window.location.pathname),formData.append("sections",sections),console.log(JSON.parse(JSON.stringify(Object.fromEntries(formData)))),{method:"POST",headers:{Accept:"application/javascript","X-Requested-With":"XMLHttpRequest"},body:formData}}createFetchBodyJSON(){const formData=new FormData(this.form),body={items:[{id:formData.get("id"),quantity:formData.get("quantity")}]};try{if(typeof PersonalizationBlock<"u"){const mainProduct=body.items[0],pid=Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER)).toString();PersonalizationBlock.selected.length>0&&(mainProduct.properties={_pid:pid}),PersonalizationBlock.selected.forEach(selected=>{mainProduct.properties._linkedItem=selected.id,selected.text&&(mainProduct.properties.text=selected.text),body.items.push({id:selected.id,quantity:mainProduct.quantity,properties:{_pid:pid,_hidden:!0}})})}}catch(error){console.error(error)}return body.sections="cart-icon-bubble",this.cartDrawer&&(body.sections+=`,${this.cartDrawer.closest(".shopify-section").id.replace("shopify-section-","")}`),body.sections_url=window.location.pathname,{method:"POST",headers:{Accept:"application/javascript","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(body)}}async handleSubmit(evt){if(evt.target.id==="product-signup_form"||(evt.preventDefault(),this.submitBtn.getAttribute("aria-disabled")==="true"))return;theme.settings.vibrateOnATC&&window.navigator.vibrate&&window.navigator.vibrate(100),this.errorMsg=null,this.setErrorMsgState(),this.submitBtn.setAttribute("aria-disabled","true"),this.submitBtn.classList.add("is-loading");const fetchRequestOpts=this.createFetchBodyJSON(),nameLastname=document.querySelector("#nombre-y-apellido_text"),error=document.querySelector("#personalization-error");if(document.querySelector("input#nombre-y-apellido")?.checked&&nameLastname?.value.trim()===""){error.style.display="block",this.submitBtn.removeAttribute("aria-disabled"),this.submitBtn.classList.remove("is-loading");return}try{const oldCartResponse=await fetch(`${theme.routes.cart}.js`);if(!oldCartResponse.ok)throw new Error(oldCartResponse.status);const oldCartData=await oldCartResponse.json(),response=await fetch(theme.routes.cartAdd,fetchRequestOpts),data=await response.json(),error2=typeof data.description=="string"?data.description:data.message;if(data.status&&this.setErrorMsgState(error2),!response.ok)throw new Error(response.status);if(theme.settings.afterAtc==="page")setTimeout(()=>{window.location.href=theme.routes.cart},300);else{ProductForm.updateCartIcon(data);const quickAddDrawer=this.closest("quick-add-drawer");quickAddDrawer&&quickAddDrawer.addedToCart(),setTimeout(()=>{if(this.cartDrawer)this.cartDrawer.renderContents(data,!quickAddDrawer&&theme.settings.afterAtc==="drawer");else if(window.location.pathname===theme.routes.cart){const cartItems=document.querySelector("cart-items");cartItems&&(cartItems.dataset.empty==="true"?window.location.reload():cartItems.refresh())}},700)}const newCartResponse=await fetch(`${theme.routes.cart}.js`);if(!newCartResponse.ok)throw new Error(newCartResponse.status);const newCartData=await newCartResponse.json(),itemInOldCart=oldCartData.items.filter(item=>item.variant_id===data.variant_id)[0];itemInOldCart?this.dispatchEvent(new CustomEvent("on:line-item:change",{bubbles:!0,detail:{cart:newCartData,variantId:data.variant_id,oldQuantity:itemInOldCart.quantity,newQuantity:itemInOldCart.quantity===data.quantity?itemInOldCart.quantity:data.quantity}})):this.dispatchEvent(new CustomEvent("on:cart:add",{bubbles:!0,detail:{cart:newCartData,variantId:data.variant_id}}))}catch(error2){console.log(error2),this.dispatchEvent(new CustomEvent("on:cart:error",{bubbles:!0,detail:{error:this.errorMsg.textContent}}))}finally{this.submitBtn.classList.add("is-success"),this.submitBtn.removeAttribute("aria-disabled"),setTimeout(()=>{this.submitBtn.classList.remove("is-loading"),this.submitBtn.classList.remove("is-success")},1400)}}static updateCartIcon(response){const cartIconBubble=document.getElementById("cart-icon-bubble");cartIconBubble&&(cartIconBubble.innerHTML=response.sections["cart-icon-bubble"])}setErrorMsgState(error=!1){this.errorMsg=this.errorMsg||this.querySelector(".js-form-error"),this.errorMsg&&(this.errorMsg.hidden=!error,error&&(this.errorMsg.textContent=error))}}customElements.define("product-form",ProductForm)}
//# sourceMappingURL=/cdn/shop/t/33/assets/product-form.js.map?v=88752929160374644151734027862
